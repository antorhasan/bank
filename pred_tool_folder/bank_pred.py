# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file '..\bank_pred.ui'
#
# Created by: PyQt5 UI code generator 5.15.1
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5 import QtCore, QtGui, QtWidgets
import webbrowser
import torch
import os
from os.path import isfile, join, isdir
from os import listdir
from pred_tool import main_program
import datetime


class Ui_main(object):

    """ 

    def train_pred_fnc(self):
        print('works!')
        print(str(number_of_steps))
        pass """

    def set_spin_tr(self):
        self.spin_val = self.spinBox_tr.value()


    def setupUi(self, main):
        
        def dwnld_ind_data_fnc():
            webbrowser.open('https://drive.google.com/drive/folders/1pYCl2s5csUchcOhAMp4l67y4K-9SO-ll?usp=sharing')
        
        #def unlabelled_tif_fnc():
        #    webbrowser.open(os.path.realpath("./data/unlabeled_tif"))

        def dwnld_all_data_fnc():
            webbrowser.open('https://drive.google.com/file/d/1xqyvSSZYaNlLsSN4Myjf-2IxfYsQ2C8T/view?usp=sharing')
        
        def val_data_msg_fnc(val_data_txt):
            val_data_msg = QtWidgets.QMessageBox()
            val_data_msg.setWindowTitle("Validation of Data")
            val_data_msg.setText(val_data_txt)
            val_data_msg.setStandardButtons(QtWidgets.QMessageBox.Ok)
            val_data_msg.exec()

        def validate_date_func():
            curr_year = datetime.datetime.now().year
            curr_month = datetime.datetime.now().month

            if curr_month > 3 :
                validate_up_year = curr_year
            elif curr_month <= 3 :
                validate_up_year = curr_year - 1

            check_years_ls = list(range(1988, int(validate_up_year)+1 , 1))
            check_years_ls = [(str(f)+'01') for f in check_years_ls]

            path_tiff = os.path.join('./all_images_lines/tiff_files/')
            path_ls = [f for f in listdir(path_tiff) if isfile(join(path_tiff, f))]
            path_ls = [int(f.split('.')[0]) for f in path_ls]
            path_ls.sort()
            path_ls = [str(f) for f in path_ls]
            #path_ls.pop()

            path_shp = os.path.join('./all_images_lines/shape_files/')
            path_shp_ls = [f for f in listdir(path_shp) if isdir(join(path_shp, f))]
            path_shp_ls = [int(f) for f in path_shp_ls]
            path_shp_ls.sort()
            path_shp_ls = [str(f) for f in path_shp_ls]
            path_shp_ls = [(str(f)+'01') for f in path_shp_ls]
            #path_shp_ls.pop()

            if path_ls == check_years_ls and path_shp_ls == check_years_ls:
                val_data_msg = 'Successfully Validated. Your Data is Up to Date'
                val_data_msg_fnc(val_data_msg)

            elif path_ls != check_years_ls or path_shp_ls != check_years_ls:
                missing_years = set(check_years_ls).difference(set(path_ls))
                missing_years = [f[:-2] for f in missing_years]
                if len(missing_years) != 0 :
                    val_data_msg_img = 'Unsuccessful Validation of Images. You are missing image data (tiff files) of the years :\n'+str(missing_years) +'\n'
                    #val_data_msg_fnc(val_data_msg)
                    
                missing_shp = set(check_years_ls).difference(set(path_shp_ls))
                missing_shp = [f[:-2] for f in missing_shp]
                if len(missing_shp) != 0 :
                    val_data_msg_lin = 'Unsuccessful Validation of Lines. You are missing line data (shape files) of the years :\n'+str(missing_shp)
                    val_data_msg = val_data_msg_img + val_data_msg_lin
                
                val_data_msg_fnc(val_data_msg)
        
        

        def run_main():
            #print(self.spin_val)
            main_program(self.spin_val)



        main.setObjectName("main")
        main.resize(1104, 887)
        self.centralwidget = QtWidgets.QWidget(main)
        self.centralwidget.setObjectName("centralwidget")

        self.tabWidget = QtWidgets.QTabWidget(self.centralwidget)
        self.tabWidget.setGeometry(QtCore.QRect(0, 0, 1101, 861))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.tabWidget.setFont(font)
        self.tabWidget.setObjectName("tabWidget")

        self.tab = QtWidgets.QWidget()
        self.tab.setObjectName("tab")
        
        """ self.label = QtWidgets.QLabel(self.tab)
        self.label.setGeometry(QtCore.QRect(280, 40, 481, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label.setFont(font)
        self.label.setObjectName("label") """

        self.dwnld_ind_data = QtWidgets.QPushButton(self.tab)
        self.dwnld_ind_data.setGeometry(QtCore.QRect(60, 110, 451, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.dwnld_ind_data.setFont(font)
        self.dwnld_ind_data.setObjectName("dwnld_ind_data")
        self.dwnld_ind_data.clicked.connect(dwnld_ind_data_fnc)

        self.dwnld_all_data = QtWidgets.QPushButton(self.tab)
        self.dwnld_all_data.setGeometry(QtCore.QRect(580, 110, 451, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.dwnld_all_data.setFont(font)
        self.dwnld_all_data.setObjectName("dwnld_all_data")
        self.dwnld_all_data.clicked.connect(dwnld_all_data_fnc)


        """ self.spinBox = QtWidgets.QSpinBox(self.tab)
        self.spinBox.setGeometry(QtCore.QRect(410, 110, 211, 31))
        font = QtGui.QFont()
        font.setPointSize(13)
        self.spinBox.setFont(font)
        self.spinBox.setMinimum(2015)
        self.spinBox.setMaximum(2030)
        self.spinBox.setObjectName("spinBox") """
        
        self.label_2 = QtWidgets.QLabel(self.tab)
        self.label_2.setGeometry(QtCore.QRect(280, 320, 481, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_2.setFont(font)
        self.label_2.setObjectName("label_2")
        self.pushButton_2 = QtWidgets.QPushButton(self.tab)
        self.pushButton_2.setGeometry(QtCore.QRect(280, 380, 451, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_2.setFont(font)
        self.pushButton_2.setObjectName("pushButton_2")

        """ self.lb_draw_bnk = QtWidgets.QLabel(self.tab)
        self.lb_draw_bnk.setGeometry(QtCore.QRect(280, 570, 481, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.lb_draw_bnk.setFont(font)
        self.lb_draw_bnk.setObjectName("lb_draw_bnk")
        
        self.bt_opn_fld = QtWidgets.QPushButton(self.tab)
        self.bt_opn_fld.setGeometry(QtCore.QRect(280, 630, 451, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.bt_opn_fld.setFont(font)
        self.bt_opn_fld.setObjectName("bt_opn_fld")
        self.bt_opn_fld.clicked.connect(unlabelled_tif_fnc) """
        
        self.bt_valdiate_data = QtWidgets.QPushButton(self.tab)
        self.bt_valdiate_data.setGeometry(QtCore.QRect(340, 550, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.bt_valdiate_data.setFont(font)
        self.bt_valdiate_data.setObjectName("bt_valdiate_data")
        self.bt_valdiate_data.clicked.connect(validate_date_func)

        

        
        self.tabWidget.addTab(self.tab, "")
        self.tab_2 = QtWidgets.QWidget()
        self.tab_2.setObjectName("tab_2")
        
        """ self.label_4 = QtWidgets.QLabel(self.tab_2)
        self.label_4.setGeometry(QtCore.QRect(310, 30, 521, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_4.setFont(font)
        self.label_4.setObjectName("label_4")
        self.pushButton_4 = QtWidgets.QPushButton(self.tab_2)
        self.pushButton_4.setGeometry(QtCore.QRect(310, 90, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_4.setFont(font)
        self.pushButton_4.setObjectName("pushButton_4")
        self.pushButton_5 = QtWidgets.QPushButton(self.tab_2)
        self.pushButton_5.setGeometry(QtCore.QRect(310, 410, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_5.setFont(font)
        self.pushButton_5.setObjectName("pushButton_5")
        self.label_5 = QtWidgets.QLabel(self.tab_2)
        self.label_5.setGeometry(QtCore.QRect(310, 350, 521, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_5.setFont(font)
        self.label_5.setObjectName("label_5")
        self.tabWidget.addTab(self.tab_2, "") """

        self.tab_3 = QtWidgets.QWidget()
        self.tab_3.setObjectName("tab_3")
        self.label_tr = QtWidgets.QLabel(self.tab_3)
        self.label_tr.setGeometry(QtCore.QRect(190, 90, 361, 41))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.label_tr.setFont(font)
        self.label_tr.setObjectName("label_tr")

        self.spinBox_tr = QtWidgets.QSpinBox(self.tab_3)
        self.spinBox_tr.setGeometry(QtCore.QRect(190, 130, 211, 31))
        font = QtGui.QFont()
        font.setPointSize(13)
        self.spinBox_tr.setFont(font)
        self.spinBox_tr.setMinimum(2018)
        self.spin_val = 2018
        self.spinBox_tr.setMaximum(2030)
        self.spinBox_tr.setObjectName("spinBox")
        self.spinBox_tr.valueChanged.connect(self.set_spin_tr)
        #self.spin_tr_value = spin_tr_value

        self.train_pred = QtWidgets.QPushButton(self.tab_3)
        self.train_pred.setGeometry(QtCore.QRect(190, 170, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.train_pred.setFont(font)
        self.train_pred.setObjectName("train_pred")
        self.train_pred.clicked.connect(run_main)


        """ self.label_6 = QtWidgets.QLabel(self.tab_3)
        self.label_6.setGeometry(QtCore.QRect(190, 40, 751, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_6.setFont(font)
        self.label_6.setObjectName("label_6") """
        self.pushButton_8 = QtWidgets.QPushButton(self.tab_3)
        self.pushButton_8.setGeometry(QtCore.QRect(190, 560, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_8.setFont(font)
        self.pushButton_8.setObjectName("pushButton_8")
        self.label_8 = QtWidgets.QLabel(self.tab_3)
        self.label_8.setGeometry(QtCore.QRect(190, 500, 751, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_8.setFont(font)
        self.label_8.setObjectName("label_8")
        self.tabWidget.addTab(self.tab_3, "")
        self.tab_4 = QtWidgets.QWidget()
        self.tab_4.setObjectName("tab_4")
        self.pushButton_7 = QtWidgets.QPushButton(self.tab_4)
        self.pushButton_7.setGeometry(QtCore.QRect(290, 160, 531, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_7.setFont(font)
        self.pushButton_7.setObjectName("pushButton_7")
        self.label_7 = QtWidgets.QLabel(self.tab_4)
        self.label_7.setGeometry(QtCore.QRect(290, 20, 501, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_7.setFont(font)
        self.label_7.setObjectName("label_7")
        self.spinBox_2 = QtWidgets.QSpinBox(self.tab_4)
        self.spinBox_2.setGeometry(QtCore.QRect(290, 110, 211, 31))
        font = QtGui.QFont()
        font.setPointSize(13)
        self.spinBox_2.setFont(font)
        self.spinBox_2.setMinimum(2015)
        self.spinBox_2.setMaximum(2030)
        self.spinBox_2.setObjectName("spinBox_2")
        self.label_9 = QtWidgets.QLabel(self.tab_4)
        self.label_9.setGeometry(QtCore.QRect(290, 70, 361, 41))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.label_9.setFont(font)
        self.label_9.setObjectName("label_9")

        self.pushButton_9 = QtWidgets.QPushButton(self.tab_4)
        self.pushButton_9.setGeometry(QtCore.QRect(290, 370, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_9.setFont(font)
        self.pushButton_9.setObjectName("pushButton_9")

        self.label_10 = QtWidgets.QLabel(self.tab_4)
        self.label_10.setGeometry(QtCore.QRect(290, 310, 501, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_10.setFont(font)
        self.label_10.setObjectName("label_10")
        self.label_11 = QtWidgets.QLabel(self.tab_4)
        self.label_11.setGeometry(QtCore.QRect(290, 560, 501, 71))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.label_11.setFont(font)
        self.label_11.setObjectName("label_11")
        self.pushButton_10 = QtWidgets.QPushButton(self.tab_4)
        self.pushButton_10.setGeometry(QtCore.QRect(290, 620, 361, 61))
        font = QtGui.QFont()
        font.setPointSize(15)
        self.pushButton_10.setFont(font)
        self.pushButton_10.setObjectName("pushButton_10")
        self.tabWidget.addTab(self.tab_4, "")
        main.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(main)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 1104, 21))
        self.menubar.setObjectName("menubar")
        main.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(main)
        self.statusbar.setObjectName("statusbar")
        main.setStatusBar(self.statusbar)

        self.retranslateUi(main)
        self.tabWidget.setCurrentIndex(0)
        QtCore.QMetaObject.connectSlotsByName(main)

        tab_dic = {'tab1':self.tab,'tab2':self.tab_2,'tab3':self.tab_3,
                    'tab4':self.tab_4}
   
        def set_logos(tab_dic):
            for i in tab_dic:
                self.logo_buet = QtWidgets.QLabel(tab_dic[i])
                self.logo_buet.setGeometry(QtCore.QRect(700, 710, 371, 101))
                self.buet_pix = QtGui.QPixmap(os.path.join('./data/assets/buet.png'))
                self.logo_buet.setScaledContents(True)
                self.logo_buet.setPixmap(self.buet_pix)
                self.logo_buet.setObjectName("logo_buet")
                self.logo_warpo = QtWidgets.QLabel(tab_dic[i])
                self.logo_warpo.setGeometry(QtCore.QRect(10, 710, 301, 101))
                self.warpo_pix = QtGui.QPixmap(os.path.join('./data/assets/warpo.png'))
                self.logo_warpo.setScaledContents(True)
                self.logo_warpo.setPixmap(self.warpo_pix)
                self.logo_warpo.setObjectName("logo_warpo")

        set_logos(tab_dic)
    

    def retranslateUi(self, main):
        _translate = QtCore.QCoreApplication.translate
        main.setWindowTitle(_translate("main", "Deep Learning Bank Erosion Prediction Tool"))
        #self.label.setText(_translate("main", "1.  Which year bank lines you want to predict ?"))
        self.dwnld_ind_data.setText(_translate("main", "Download Individual Satellite Images and Lines"))
        self.dwnld_all_data.setText(_translate("main", "Download all Satellite Images and Lines"))

        self.label_2.setText(_translate("main", "2.  Preview downloaded tiff files"))
        self.pushButton_2.setText(_translate("main", "Select Tiff File"))

        #self.lb_draw_bnk.setText(_translate("main", "3.  Images that require banklines to be drawn using QGIS:"))
        #self.bt_opn_fld.setText(_translate("main", "Open Folder"))
        self.bt_valdiate_data.setText(_translate("main", "Validate Available Data"))        
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab), _translate("main", "Data Download"))
        
        """ self.label_4.setText(_translate("main", "4.  Validate if required Tiff  and Shape Files are available"))
        self.pushButton_4.setText(_translate("main", "Validate Available Data"))
        self.pushButton_5.setText(_translate("main", "Choose Location"))
        self.label_5.setText(_translate("main", "5. Process and export model ready data to path :"))
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab_2), _translate("main", "Data Preparation")) """
        
        self.label_tr.setText(_translate("main", "Choose which year you want to predict"))
        self.train_pred.setText(_translate("main", "Train Default Model "))
        
        #self.label_6.setText(_translate("main", "6a. Train a deep learning model with recommended model training configuration :"))
        self.pushButton_8.setText(_translate("main", "Train Custom Model"))
        self.label_8.setText(_translate("main", "6b. Train a deep learning model with custom model training configuration :"))
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab_3), _translate("main", "Model Training"))
        self.pushButton_7.setText(_translate("main", "Choose Model Location and Predict Bank lines"))
        self.label_7.setText(_translate("main", "7. Choose trained model and predict future banklines :"))
        self.label_9.setText(_translate("main", "Choose year to predict"))

        self.pushButton_9.setText(_translate("main", "View Results in Raster Image"))
        
        self.label_10.setText(_translate("main", "8. Preview prediction results"))
        self.label_11.setText(_translate("main", "9. Export Predicted Lines as a shape file :"))
        self.pushButton_10.setText(_translate("main", "Choose Location"))
        self.tabWidget.setTabText(self.tabWidget.indexOf(self.tab_4), _translate("main", "Get Predictions"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    main = QtWidgets.QMainWindow()
    ui = Ui_main()
    ui.setupUi(main)
    main.show()
    sys.exit(app.exec_())
